params:
- {name: showCS, value: false}
- {name: d, value: 0}
- {name: p, value: 10, min: 0, max: 35, round: 0.5}
- {name: op1, value: 0.15}
- {name: op2, value: 0.1}
- {name: ops, value: 0.2}
- {name: b111, value: 32}
- {name: b112, value: 20}
- {name: b121, value: 12}
- {name: b122, value: 8}

- {name: b211, value: 5}
- {name: b212, value: 4}
- {name: b221, value: 3}
- {name: b222, value: 2}

- {name: b311, value: 1}
- {name: b312, value: 1}
- {name: b321, value: 1}
- {name: b322, value: 1}

calcs:
  b11: ((params.b111)+(params.b112))/2
  b12: ((params.b121)+(params.b122))/2
  b21: ((params.b211)+(params.b212))/2
  b22: ((params.b221)+(params.b222))/2
  b31: ((params.b311)+(params.b312))/2
  b32: ((params.b321)+(params.b322))/2
  b1: ((params.b111)+(params.b112)+(params.b121)+(params.b122))/4
  b2: ((params.b211)+(params.b212)+(params.b221)+(params.b222))/4
  b3: ((params.b311)+(params.b312)+(params.b321)+(params.b322))/4
  cs0: max((calcs.b1)-(params.p),0)+max((calcs.b2)-(params.p),0)+max((calcs.b3)-(params.p),0)
  cs1: (max((calcs.b11)-(params.p),0)+max((calcs.b12)-(params.p),0)+max((calcs.b21)-(params.p),0)
        +max((calcs.b22)-(params.p),0)+max((calcs.b31)-(params.p),0)+max((calcs.b32)-(params.p),0))/2
  cs2: (max((params.b111)-(params.p),0)+max((params.b112)-(params.p),0)+max((params.b121)-(params.p),0)+
    max((params.b122)-(params.p),0)+max((params.b211)-(params.p),0)+max((params.b212)-(params.p),0)+
    max((params.b221)-(params.p),0)+max((params.b222)-(params.p),0)+max((params.b311)-(params.p),0)+
    max((params.b312)-(params.p),0)+max((params.b321)-(params.p),0)+max((params.b322)-(params.p),0))/4

aspectRatio: 1

layout:
  OneGraphPlusSidebar:
    graph: 
      xAxis:
        title: Unità del bene
        max: 3.5
      yAxis:
        title: Euro
        max: (params.b111)+1
        ticks: 10

      objects:

# price line
        - Line: {point: [0,params.p], slope: 0, color: Green, strokeWidth: 1, label: {text: "P", x: 3.4, position: b}}

# WTP for whole units
        - Point: {coordinates: [1,calcs.b1], color: Blue, droplines: {horizontal: calcs.b1, vertical: }, show: params.d == 0}
        - Point: {coordinates: [2,calcs.b2], color: Blue, droplines: {horizontal: calcs.b2, vertical: }, show: params.d == 0}
        - Point: {coordinates: [3,calcs.b3], color: Blue, droplines: {horizontal: calcs.b3, vertical: }, show: params.d == 0}

        - Point: {coordinates: [1,calcs.b1], color: Blue, show: params.d == 1, opacity: params.op1}
        - Segment: {a: [0,calcs.b1], b: [1,calcs.b1], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Segment: {a: [1,calcs.b1], b: [1,0], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Point: {coordinates: [2,calcs.b2], color: Blue, show: params.d == 1, opacity: params.op1}
        - Segment: {a: [0,calcs.b2], b: [2,calcs.b2], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Segment: {a: [2,calcs.b2], b: [2,0], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Point: {coordinates: [3,calcs.b3], color: Blue, show: params.d == 1, opacity: params.op1}
        - Segment: {a: [0,calcs.b3], b: [3,calcs.b3], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Segment: {a: [3,calcs.b3], b: [3,0], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}

        - Point: {coordinates: [1,calcs.b1], color: Blue, show: params.d == 2, opacity: params.op2}
        - Segment: {a: [0,calcs.b1], b: [1,calcs.b1], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [1,calcs.b1], b: [1,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [2,calcs.b2], color: Blue, show: params.d == 2, opacity: params.op2}
        - Segment: {a: [0,calcs.b2], b: [2,calcs.b2], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [2,calcs.b2], b: [2,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [3,calcs.b3], color: Blue, show: params.d == 2, opacity: params.op2}
        - Segment: {a: [0,calcs.b3], b: [3,calcs.b3], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [3,calcs.b3], b: [3,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}

# WTP for half units
        - Point: {coordinates: [0.5,calcs.b11], color: Blue, droplines: {horizontal: calcs.b11, vertical: }, show: params.d == 1}
        - Point: {coordinates: [1,calcs.b12], color: Blue, droplines: {horizontal: calcs.b12, vertical: }, show: params.d == 1}
        - Point: {coordinates: [1.5,calcs.b21], color: Blue, droplines: {horizontal: calcs.b21, vertical: }, show: params.d == 1}
        - Point: {coordinates: [2,calcs.b22], color: Blue, droplines: {horizontal: calcs.b22, vertical: }, show: params.d == 1}
        - Point: {coordinates: [2.5,calcs.b31], color: Blue, droplines: {horizontal: calcs.b31, vertical: }, show: params.d == 1}
        - Point: {coordinates: [3,calcs.b32], color: Blue, droplines: {horizontal: calcs.b32, vertical: }, show: params.d == 1}

        - Point: {coordinates: [0.5,calcs.b11], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,calcs.b11], b: [0.5,calcs.b11], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [0.5,calcs.b11], b: [0.5,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [1,calcs.b12], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,calcs.b12], b: [1,calcs.b12], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [1,calcs.b12], b: [1,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [1.5,calcs.b21], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,calcs.b21], b: [1.5,calcs.b21], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [1.5,calcs.b21], b: [1.5,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [2,calcs.b22], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,calcs.b22], b: [2,calcs.b22], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [2,calcs.b22], b: [2,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [2.5,calcs.b31], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,calcs.b31], b: [2.5,calcs.b31], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [2.5,calcs.b31], b: [2.5,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [3,calcs.b3], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,calcs.b32], b: [3,calcs.b32], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [3,calcs.b32], b: [3,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}

# WTP for quarter units
        - Point: {coordinates: [0.25,params.b111], color: Blue, droplines: {horizontal: params.b111, vertical: }, show: params.d == 2}
        - Point: {coordinates: [0.5,params.b112], color: Blue, droplines: {horizontal: params.b112, vertical: }, show: params.d == 2}
        - Point: {coordinates: [0.75,params.b121], color: Blue, droplines: {horizontal: params.b121, vertical: }, show: params.d == 2}
        - Point: {coordinates: [1,params.b122], color: Blue, droplines: {horizontal: params.b122, vertical: }, show: params.d == 2}
        - Point: {coordinates: [1.25,params.b211], color: Blue, droplines: {horizontal: params.b211, vertical: }, show: params.d == 2}
        - Point: {coordinates: [1.5,params.b212], color: Blue, droplines: {horizontal: params.b212, vertical: }, show: params.d == 2}
        - Point: {coordinates: [1.75,params.b221], color: Blue, droplines: {horizontal: params.b221, vertical: }, show: params.d == 2}
        - Point: {coordinates: [2,params.b222], color: Blue, droplines: {horizontal: params.b222, vertical: }, show: params.d == 2}
        - Point: {coordinates: [2.25,params.b311], color: Blue, droplines: {horizontal: params.b311, vertical: }, show: params.d == 2}
        - Point: {coordinates: [2.5,params.b312], color: Blue, droplines: {horizontal: params.b312, vertical: }, show: params.d == 2}
        - Point: {coordinates: [2.75,params.b321], color: Blue, droplines: {horizontal: params.b321, vertical: }, show: params.d == 2}
        - Point: {coordinates: [3,params.b322], color: Blue, droplines: {horizontal: params.b322, vertical: }, show: params.d == 2}


# consumer surplus
        - Area: {fn1: calcs.b1, fn2: params.p, fill: Blue, opacity: params.ops, min: 0, max: 1, show: params.p < calcs.b1 && params.d == 0 && params.showCS == true}
        - Area: {fn1: calcs.b2, fn2: params.p, fill: Blue, opacity: params.ops, min: 1, max: 2, show: params.p < calcs.b2 && params.d == 0 && params.showCS == true}
        - Area: {fn1: calcs.b3, fn2: params.p, fill: Blue, opacity: params.ops, min: 2, max: 3, show: params.p < calcs.b3 && params.d == 0 && params.showCS == true}

        - Area: {fn1: calcs.b11, fn2: params.p, fill: Blue, opacity: params.ops, min: 0, max: 0.5, show: params.p < calcs.b11 && params.d == 1 && params.showCS == true}
        - Area: {fn1: calcs.b12, fn2: params.p, fill: Blue, opacity: params.ops, min: 0.5, max: 1, show: params.p < calcs.b12 && params.d == 1 && params.showCS == true}
        - Area: {fn1: calcs.b21, fn2: params.p, fill: Blue, opacity: params.ops, min: 1, max: 1.5, show: params.p < calcs.b21 && params.d == 1 && params.showCS == true}
        - Area: {fn1: calcs.b22, fn2: params.p, fill: Blue, opacity: params.ops, min: 1.5, max: 2, show: params.p < calcs.b22 && params.d == 1 && params.showCS == true}
        - Area: {fn1: calcs.b31, fn2: params.p, fill: Blue, opacity: params.ops, min: 2, max: 2.5, show: params.p < calcs.b31 && params.d == 1 && params.showCS == true}
        - Area: {fn1: calcs.b32, fn2: params.p, fill: Blue, opacity: params.ops, min: 2.5, max: 3, show: params.p < calcs.b32 && params.d == 1 && params.showCS == true}

        - Area: {fn1: params.b111, fn2: params.p, fill: Blue, opacity: params.ops, min: 0, max: 0.25, show: params.p < params.b111 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b112, fn2: params.p, fill: Blue, opacity: params.ops, min: 0.25, max: 0.5, show: params.p < params.b112 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b121, fn2: params.p, fill: Blue, opacity: params.ops, min: 0.5, max: 0.75, show: params.p < params.b121 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b122, fn2: params.p, fill: Blue, opacity: params.ops, min: 0.75, max: 1, show: params.p < params.b122 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b211, fn2: params.p, fill: Blue, opacity: params.ops, min: 1, max: 1.25, show: params.p < params.b211 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b212, fn2: params.p, fill: Blue, opacity: params.ops, min: 1.25, max: 1.5, show: params.p < params.b212 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b221, fn2: params.p, fill: Blue, opacity: params.ops, min: 1.5, max: 1.75, show: params.p < params.b221 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b222, fn2: params.p, fill: Blue, opacity: params.ops, min: 1.75, max: 2, show: params.p < params.b222 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b311, fn2: params.p, fill: Blue, opacity: params.ops, min: 2, max: 2.25, show: params.p < params.b311 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b312, fn2: params.p, fill: Blue, opacity: params.ops, min: 2.25, max: 2.5, show: params.p < params.b312 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b321, fn2: params.p, fill: Blue, opacity: params.ops, min: 2.5, max: 2.75, show: params.p < params.b321 && params.d == 2 && params.showCS == true}
        - Area: {fn1: params.b322, fn2: params.p, fill: Blue, opacity: params.ops, min: 2.75, max: 3, show: params.p < params.b322 && params.d == 2 && params.showCS == true}

    sidebar:
      controls:
      - title: Graph Title
        description: This is a description.
        sliders:
        - param: p
          label: \text{Prezzo}
        radioGroup:
          param: d
          options:
            - Bene venduto in multipli di $1$
            - Bene venduto in multipli di $0.5$
            - Bene venduto in multipli di $0.25$
        checkboxes:
        - param: showCS
          label: "\\text{Mostra e calcola il surplus del consumatore}"
        divs:
        - html: "`  `"
        - html: "`Il surplus del consumatore (area azzurra) è pari a $$ \\\\text{CS} = ${calcs.cs0.toFixed(1)} $$`"
          show: (params.d == 0 && params.showCS == true)
        - html: "`Il surplus del consumatore (area azzurra) è pari a $$ \\\\text{CS} = ${calcs.cs1.toFixed(1)} $$`"
          show: (params.d == 1 && params.showCS == true)
        - html: "`Il surplus del consumatore (area azzurra) è pari a $$ \\\\text{CS} = ${calcs.cs2.toFixed(1)} $$`"
          show: (params.d == 2 && params.showCS == true)

    explanation:
      divs:
        - html: "`When $P = ${params.p11.toFixed(1)}$, $CS = ${calcs.cs0}$ the consumer sets $MB= P$ at $Q = ${calcs.c.toFixed(1)}$ and the firm sets $P = MC$ at $Q = ${calcs.c.toFixed(1)}$.`"
        - html: "`If we assume the total amount produced and consumed must be the smaller of those two, then the amount in the market is $Q = ${calcs.c.toFixed(2)}$. At that quantity, $MB > MC$, so total surplus could be increased if $Q$ were higher.`"
          show: params.p11 != 1
        - html: Since the amount the firm makes is the amount the consumer wants to consume, the market would be in competitive equilibrium. If you move the price up and down, you can see that the total surplus at the equilibrium price is higher than at any other price.
          show: params.p11 == 1

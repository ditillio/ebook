params:
- {name: showCS, value: false}
- {name: d, value: 0}
- {name: p, value: 80, min: 25, max: 150}
- {name: m, value: 100}
- {name: op1, value: 0.15}
- {name: op2, value: 0.1}
- {name: ops, value: 0.2}

- {name: b11, value: 140}
- {name: b12, value: 60}
- {name: b21, value: 46}
- {name: b22, value: 38}
- {name: b31, value: 32}
- {name: b32, value: 30}


calcs:
  b1: ((params.b11)+(params.b12))/2
  b2: ((params.b21)+(params.b22))/2
  b3: ((params.b31)+(params.b32))/2
  t11: (params.b11)/2
  t12: (params.b11+params.b12)/2
  t21: (params.b11+params.b12+params.b21)/2
  t22: (params.b11+params.b12+params.b21+params.b22)/2
  t31: (params.b11+params.b12+params.b21+params.b22+params.b31)/2
  t32: (params.b11+params.b12+params.b21+params.b22+params.b31+params.b32)/2
  t1: calcs.b1
  t2: calcs.t1+calcs.b2
  t3: calcs.t2+calcs.b3
  cs0: max((calcs.b1)-(params.p),0)+max((calcs.b2)-(params.p),0)+max((calcs.b3)-(params.p),0)
  cs1: (max((params.b11)-(params.p),0)+max((params.b12)-(params.p),0)+max((params.b21)-(params.p),0)
        +max((params.b22)-(params.p),0)+max((params.b31)-(params.p),0)+max((params.b32)-(params.p),0))/2

aspectRatio: 1.5

layout:
  OneGraphPlusSidebar:
    graph: 
      xAxis:
        title: Unità del bene
        max: 3.05
        ticks: 5
      yAxis:
        title: Euro
        max: (params.b11)+5
        ticks: 3

      objects:

# WTP in infinitely divisible case
        - Curve:
            fn: (params.m/2)/(sqrt(x))
            color: Blue
            strokeWidth: 1.5
            show: params.d == 2

# price line
        - Line:
            yIntercept: params.p
            color: Green
            strokeWidth: 1.5
            label:
              text: P
              x: 3.1
              position: b
            drag:
              - vertical: p

# WTP for whole units
        - Point: {coordinates: [1,calcs.b1], color: Blue, droplines: {horizontal: calcs.b1, vertical: }, show: params.d == 0}
        - Point: {coordinates: [2,calcs.b2], color: Blue, droplines: {horizontal: calcs.b2, vertical: }, show: params.d == 0}
        - Point: {coordinates: [3,calcs.b3], color: Blue, droplines: {horizontal: calcs.b3, vertical: }, show: params.d == 0}

        - Point: {coordinates: [1,calcs.b1], color: Blue, show: params.d == 1, opacity: params.op1}
        - Segment: {a: [0,calcs.b1], b: [1,calcs.b1], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Segment: {a: [1,calcs.b1], b: [1,0], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Point: {coordinates: [2,calcs.b2], color: Blue, show: params.d == 1, opacity: params.op1}
        - Segment: {a: [0,calcs.b2], b: [2,calcs.b2], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Segment: {a: [2,calcs.b2], b: [2,0], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Point: {coordinates: [3,calcs.b3], color: Blue, show: params.d == 1, opacity: params.op1}
        - Segment: {a: [0,calcs.b3], b: [3,calcs.b3], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}
        - Segment: {a: [3,calcs.b3], b: [3,0], lineStyle: dotted, color: Blue, show: params.d == 1, strokeWidth: 0.2}

        - Point: {coordinates: [1,calcs.b1], color: Blue, show: params.d == 2, opacity: params.op2}
        - Segment: {a: [0,calcs.b1], b: [1,calcs.b1], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [1,calcs.b1], b: [1,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [2,calcs.b2], color: Blue, show: params.d == 2, opacity: params.op2}
        - Segment: {a: [0,calcs.b2], b: [2,calcs.b2], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [2,calcs.b2], b: [2,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [3,calcs.b3], color: Blue, show: params.d == 2, opacity: params.op2}
        - Segment: {a: [0,calcs.b3], b: [3,calcs.b3], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [3,calcs.b3], b: [3,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}

# WTP for half units
        - Point: {coordinates: [0.5,params.b11], color: Blue, droplines: {horizontal: params.b11, vertical: }, show: params.d == 1}
        - Point: {coordinates: [1,params.b12], color: Blue, droplines: {horizontal: params.b12, vertical: }, show: params.d == 1}
        - Point: {coordinates: [1.5,params.b21], color: Blue, droplines: {horizontal: params.b21, vertical: }, show: params.d == 1}
        - Point: {coordinates: [2,params.b22], color: Blue, droplines: {horizontal: params.b22, vertical: }, show: params.d == 1}
        - Point: {coordinates: [2.5,params.b31], color: Blue, droplines: {horizontal: params.b31, vertical: }, show: params.d == 1}
        - Point: {coordinates: [3,params.b32], color: Blue, droplines: {horizontal: params.b32, vertical: }, show: params.d == 1}

        - Point: {coordinates: [0.5,params.b11], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,params.b11], b: [0.5,params.b11], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [0.5,params.b11], b: [0.5,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [1,params.b12], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,params.b12], b: [1,params.b12], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [1,params.b12], b: [1,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [1.5,params.b21], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,params.b21], b: [1.5,params.b21], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [1.5,params.b21], b: [1.5,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [2,params.b22], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,params.b22], b: [2,params.b22], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [2,params.b22], b: [2,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [2.5,params.b31], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,params.b31], b: [2.5,params.b31], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [2.5,params.b31], b: [2.5,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Point: {coordinates: [3,params.b3], color: Blue, show: params.d == 2, opacity: params.op1}
        - Segment: {a: [0,params.b32], b: [3,params.b32], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}
        - Segment: {a: [3,params.b32], b: [3,0], lineStyle: dotted, color: Blue, show: params.d == 2, strokeWidth: 0.2}



# consumer surplus
        - Area: {fn1: calcs.b1, fn2: params.p, fill: Blue, opacity: params.ops, min: 0, max: 1, show: params.p < calcs.b1 && params.d == 0 && params.showCS == true}
        - Area: {fn1: calcs.b2, fn2: params.p, fill: Blue, opacity: params.ops, min: 1, max: 2, show: params.p < calcs.b2 && params.d == 0 && params.showCS == true}
        - Area: {fn1: calcs.b3, fn2: params.p, fill: Blue, opacity: params.ops, min: 2, max: 3, show: params.p < calcs.b3 && params.d == 0 && params.showCS == true}

        - Area: {fn1: params.b11, fn2: params.p, fill: Blue, opacity: params.ops, min: 0, max: 0.5, show: params.p < params.b11 && params.d == 1 && params.showCS == true}
        - Area: {fn1: params.b12, fn2: params.p, fill: Blue, opacity: params.ops, min: 0.5, max: 1, show: params.p < params.b12 && params.d == 1 && params.showCS == true}
        - Area: {fn1: params.b21, fn2: params.p, fill: Blue, opacity: params.ops, min: 1, max: 1.5, show: params.p < params.b21 && params.d == 1 && params.showCS == true}
        - Area: {fn1: params.b22, fn2: params.p, fill: Blue, opacity: params.ops, min: 1.5, max: 2, show: params.p < params.b22 && params.d == 1 && params.showCS == true}
        - Area: {fn1: params.b31, fn2: params.p, fill: Blue, opacity: params.ops, min: 2, max: 2.5, show: params.p < params.b31 && params.d == 1 && params.showCS == true}
        - Area: {fn1: params.b32, fn2: params.p, fill: Blue, opacity: params.ops, min: 2.5, max: 3, show: params.p < params.b32 && params.d == 1 && params.showCS == true}

        - Area: {fn1: (params.m/2)/(sqrt(x)), fn2: params.p, fill: Blue, opacity: params.ops, min: 0.001, 
                        max: (params.m/(2*params.p))^2, show: params.d == 2 && params.showCS == true}




    sidebar:
      controls:
      - title: Divisibilità dei beni
        sliders:
        - param: p
          label: P
        radioGroup:
          param: d
          options:
            - Bene venduto in multipli di $1$
            - Bene venduto in multipli di $0.5$
            - Bene infinitamente divisibile
        checkboxes:
        - param: showCS
          label: "\\text{Mostra e calcola il surplus del consumatore}"
        divs:
        - html: "`  `"
        - html: "`Il surplus del consumatore (area azzurra) è pari a $$ \\\\text{CS} = ${calcs.cs0.toFixed(1)} $$`"
          show: (params.d == 0 && params.showCS == true)
        - html: "`Il surplus del consumatore (area azzurra) è pari a $$ \\\\text{CS} = ${calcs.cs1.toFixed(1)} $$`"
          show: (params.d == 1 && params.showCS == true)
        - html: "`Il surplus del consumatore (area azzurra) è pari a $$ \\\\text{CS} = ${(params.m*params.m)/(4*(params.p))} $$`"
          show: (params.d == 2 && params.showCS == true)

    explanation:
      divs:
        - html: "`Spiegazione ? .. `"
          show: params.p != 1000

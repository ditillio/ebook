params:
- {name: showCS, value: false}
- {name: p, value: 300, min: 0, max: 540, round: 10}
- {name: op1, value: 0.15}
- {name: op2, value: 0.1}
- {name: ops, value: 0.2}
- {name: b1, value: 500}
- {name: b2, value: 200}
- {name: b3, value: 100}
- {name: b4, value: 50}

calcs:
  cs: max((params.b1)-(params.p),0)+max((params.b2)-(params.p),0)+max((params.b3)-(params.p),0)+max((params.b4)-(params.p),0)

aspectRatio: 1.5

layout:
  OneGraphPlusSidebar:
    graph: 
      xAxis:
        title: Unità del bene
        max: 5.2
        ticks: 4
      yAxis:
        title: Euro
        max: 550
        ticks: 5

      objects:

# price line
        - Line:
            yIntercept: params.p
            color: Green
            strokeWidth: 1.5
            label:
              text: P
              x: 5
              position: b
            drag:
              - vertical: p

# WTP for whole units
        - Point: {coordinates: [1,params.b1], color: Blue, droplines: {horizontal: params.b1, vertical: }}
        - Point: {coordinates: [2,params.b2], color: Blue, droplines: {horizontal: params.b2, vertical: }}
        - Point: {coordinates: [3,params.b3], color: Blue, droplines: {horizontal: params.b3, vertical: }}
        - Point: {coordinates: [4,params.b4], color: Blue, droplines: {horizontal: params.b4, vertical: }}

# consumer surplus
        - Area: {fn1: params.b1, fn2: params.p, fill: Blue, opacity: params.ops, min: 0, max: 1, show: params.p < params.b1 }
        - Area: {fn1: params.b2, fn2: params.p, fill: Blue, opacity: params.ops, min: 1, max: 2, show: params.p < params.b2 }
        - Area: {fn1: params.b3, fn2: params.p, fill: Blue, opacity: params.ops, min: 2, max: 3, show: params.p < params.b3 }
        - Area: {fn1: params.b4, fn2: params.p, fill: Blue, opacity: params.ops, min: 3, max: 4, show: params.p < params.b4 }

    sidebar:
      controls:
      - title: Surplus del consumatore
        description: Spostare il cursore qui sotto (o muovere la retta orizzontale nel grafico) per vedere come varia il
                        surplus del consumatore al variare del prezzo del bene.
        sliders:
        - param: p
          label: P
        divs:
        - html: "`Quando $ P = ${params.p} $ il consumatore non acquista il bene, dato che anche la prima unità,
        quella che per lui vale di più, ovvero ${params.b1.toFixed(0)}, costa più di ${params.b1.toFixed(0)}. Il surplus
        del consumatore è $CS=0$.`"
          show: (params.p > params.b1) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista una unità del bene (è in realtà indifferente tra acquistarne una unità e 
        non acquistarlo affatto). Infatti
        la prima unità, quella che per lui vale di più, costa tanto quanto essa vale per lui, ovvero ${params.b1.toFixed(0)}. Non ne
         acquista di più perché la seconda, terza, quarta, quinta, ... unità per lui valgono ${params.b2}, ${params.b3}, ${params.b4}, $0$, ...,
         cioè tutte meno di ${params.p}. Il surplus del consumatore è $CS=0$.`"
          show: (params.p == params.b1) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista una unità del bene, che per lui vale ${params.b1}. Non ne acquista di più perché 
        la seconda, terza, quarta, quinta, ... unità per lui valgono ${params.b2}, ${params.b3}, ${params.b4}, $0$ ..., cioè tutte meno di ${params.p}.
        Il surplus del consumatore (area azzurra) è
        $$ CS = ${params.b1} - ${params.p} = ${calcs.cs} $$ `"
          show: (params.b2 < params.p) && (params.p < params.b1) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista due unità del bene (è in realtà indifferente tra acquistarne una o due, dato che la seconda 
        unità costa tanto quanto essa vale per lui). Non ne acquista più di due perché 
        la terza, quarta, quinta, ... unità per lui valgono ${params.b3}, ${params.b4}, $0$, ..., cioè tutte meno di ${params.p}.
        Il surplus del consumatore (area azzurra) è
        $$ CS = ${params.b1}+${params.b2} - 2\\\\times ${params.p} = ${calcs.cs} $$ `"
          show: (params.b2 == params.p) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista due unità del bene, che per lui valgono complessivamente 
        $ ${params.b1} + ${params.b2} = ${params.b1 + params.b2} $. Non ne acquista di più perché 
        la terza, quarta, quinta, ... unità per lui valgono ${params.b3}, ${params.b4}, $0$, ..., cioè tutte meno di ${params.p}.
        Il surplus del consumatore (area azzurra) è
        $$ CS = ${params.b1}+${params.b2} - 2\\\\times ${params.p} = ${calcs.cs} $$ `"
          show: (params.b3 < params.p) && (params.p < params.b2) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista tre unità del bene (è in realtà indifferente tra acquistarne due o tre, dato che la terza 
        unità costa tanto quanto essa vale per lui). Non ne acquista più di tre perché 
        la quarta, quinta, ... unità per lui valgono ${params.b4}, $0$, ..., cioè tutte meno di ${params.p}.
        Il surplus del consumatore (area azzurra) è
        $$ CS = ${params.b1}+${params.b2}+${params.b3} - 3\\\\times ${params.p} = ${calcs.cs} $$ `"
          show: (params.b3 == params.p) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista tre unità del bene, che per lui valgono complessivamente 
        $ ${params.b1} + ${params.b2} + ${params.b3} = ${params.b1 + params.b2 + params.b3} $. Non ne acquista di più perché 
        la quarta, quinta, ... unità per lui valgono ${params.b4}, $0$, ..., cioè tutte meno di ${params.p}.
        Il surplus del consumatore (area azzurra) è
        $$ CS = ${params.b1}+${params.b2}+${params.b3} - 3\\\\times ${params.p} = ${calcs.cs} $$ `"
          show: (params.b4 < params.p) && (params.p < params.b3) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista quattro unità del bene (è in realtà indifferente tra acquistarne tre o quattro,
         dato che la quarta 
        unità costa tanto quanto essa vale per lui). Non ne acquista più di quattro perché 
        la quinta, sesta, ... unità per lui valgono $0$, ..., cioè tutte meno di ${params.p}.
        Il surplus del consumatore (area azzurra) è
        $$ CS = ${params.b1}+${params.b2}+${params.b3}+${params.b4} - 4\\\\times ${params.p} = ${calcs.cs} $$ `"
          show: (params.b4 == params.p) 
        - html: "`Quando $ P = ${params.p} $ il consumatore acquista quattro unità del bene, che per lui valgono complessivamente 
        $ ${params.b1} + ${params.b2} + ${params.b3} + ${params.b4} = ${params.b1 + params.b2 + params.b3 + params.b4} $. Non ne acquista di più perché 
        la quinta, sesta, ... unità per lui valgono $0$, ..., cioè tutte meno di ${params.p}.
        $$ CS = ${params.b1}+${params.b2}+${params.b3}+${params.b4} - 4\\\\times ${params.p} = ${calcs.cs} $$ `"
          show: (params.b4 > params.p) 
